<krpano current_floor_map="">
	<this></this>
	<hotspot name="hs0" keep="true"/>
	<style name="invisible_content" visible="false" alpha="0" show_before="" show_precall="" show_after="" show_fast_precall="" hide_precall="" hide_before="" hide_after="" hide_fast_precall="" tween_duration="0.25" target_alpha="1" hidden_alpha="0" tween_type="default" allow_showing="true" allow_hiding="true" tween_in_progress="false" show_delay="0" hide_delay="0" show=" show_precall(); if (allow_showing, stop_tween(); if (!visible OR alpha != target_alpha, delayedcall(get(name), get(show_delay), set(visible, true); show_before(); set(tween_in_progress, true); tween(alpha, get(target_alpha), get(tween_duration), get(tween_type), set(tween_in_progress, false); show_after(); ); ); ); ); " hide=" hide_precall(); if (allow_hiding, stop_tween(); if (visible, delayedcall(get(name), get(hide_delay), hide_before(); set(tween_in_progress, true); tween(alpha, get(hidden_alpha), get(tween_duration), get(tween_type), if (hidden_alpha == 0, set(visible, false); , set(enabled, false); ); set(tween_in_progress, false); hide_after(); ); ); ); ); " stop_tween=" stoptween(alpha); set(tween_in_progress, false); " show_fast=" show_fast_precall(); if (allow_showing, stop_tween(); show_before(); ifnot(visible, set(visible, true); copy(alpha, target_alpha); , set(tween_in_progress, false); ); ); " hide_fast=" hide_fast_precall(); stop_tween(); if (visible AND allow_hiding, hide_before(); copy(alpha, hidden_alpha); if (hidden_alpha == 0, set(visible, false); , set(enabled, false); ); , set(tween_in_progress, false); ); hide_after(); "></style>
	<style name="visible" visible="true" alpha="1"></style>
	<style name="reliable_width" width_available="false" onloaded=" onloaded_override(); asynccall(width == 0 OR width == null, onwidth(); set(width_available, true); ); " onwidth="" onloaded_override=""></style>
	<style name="reliable_height" height_available="false" onloaded=" onloaded_override(); asynccall(height == 0 OR height == null, onheight(); set(height_available, true); ); " onheight="" onloaded_override=""></style>
	<action name="new" type="javascript">
		<![CDATA[ const [f, className, name, ...params] = args; const classArray = className.split("|"); let constructorClass = ""; for (let classItem of classArray) { if (classItem != "visible" && krpano.get(`style[${classItem}].${classItem}`)) { constructorClass = classItem; } } krpano.call(`style[${constructorClass}].${constructorClass}(${name}, ${className}, ${params.join(", ")});`); ]]>
	</action>
	<action name="newhotspot">addhotspot(%1, this); this.loadstyle(%2);</action>
	<action name="newlayer">addlayer(%1, this); this.loadstyle(%2);</action>
	<action name="asynccall">asyncloop( %1, , %2 );</action>
	<console line_no="0" log=" if (%1 OR %1 == 0 OR %1 == false, trace(get(console.line_no), ' | name: ', get(name), ' :: ', calc(%1)); , %1 == NaN, trace(get(console.line_no), ' | name: ', get(name), ' :: %1 = NaN'); , %1 == null, trace(get(console.line_no), ' | name: ', get(name), ' :: %1 = null'); , %1 == '', trace(get(console.line_no), ' | name: ', get(name), ' :: empty string'); ); inc(console.line_no); showlog(); " divider=" trace('----------------------------------------------------'); " msg=" trace(get(console.line_no), ' | ', %1); inc(console.line_no); showlog(); " var_name="" var=" set(var_name, %1); if ( %1 OR %1 == 0, trace(get(console.line_no), ' | name: ', get(name), ' :: ', var_name, ' = ', calc(%1)); , %1 === null, trace(get(console.line_no), ' | name: ', get(name), ' :: ', var_name, ' = null'); , %1 === NaN, trace(get(console.line_no), ' | name: ', get(name), ' :: ', var_name, ' = NaN'); ); inc(console.line_no); showlog(); "/>
	<plugin url="../plugins/moretweentypes.js" preload="true"/>
	<action name="load_scene">loadscene(%1, %2, MERGE, BLEND(0.5, linear));</action>
	<action name="register_backdropblur" type="Javascript">let backdropblur = 0.0; caller.registerattribute('backdropblur', 0.0, function(v) { backdropblur = +v; if (isNaN(backdropblur)) backdropblur = 0.0; let style = caller.sprite.style; style[`backdrop-filter`] = style[`-webkit-backdrop-filter`] = `blur(${backdropblur}px)`; }, function() {return backdropblur});</action>
	<style name="backdropblur" onloaded.addevent="register_backdropblur()"></style>
	<style name="interactive_area" url="get:data[void].content" width="100%" height="100%" ondown=" callwith(layer[get(parent)], ondown); " onup=" callwith(layer[get(parent)], onup); " onover=" callwith(layer[get(parent)], onover); " onout=" callwith(layer[get(parent)], onout); " onclick=" delayedcall(0.1, onclick_actions(); ); " onclick_actions=" callwith(layer[get(parent)], onclick_actions); "></style>
	<action name="startup" autorun="onstart">js( getKRPano() ); js( setKRPanoConsole(450, 18) ); load_floor_maps(); load_scene(get(startscene));</action>
	<data name="void">
		<![CDATA[data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAHymlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDEzLTExLTIyVDE4OjM5OjQyKzA0OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNy0yM1QxNjo1MDo0NSswMzowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNy0yM1QxNjo1MDo0NSswMzowMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpiMjI1NDA4My01Yjc3LTQ3YjItYTNhMy1mMzRmYzQ4Y2JhODgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RUNBQzNCQTQ1MzgzMTFFMzlGNDJEQ0ZFRjFERTg0NjkiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpFQ0FDM0JBNDUzODMxMUUzOUY0MkRDRkVGMURFODQ2OSIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgdGlmZjpPcmllbnRhdGlvbj0iMSIgdGlmZjpYUmVzb2x1dGlvbj0iNzIwMDAwLzEwMDAwIiB0aWZmOllSZXNvbHV0aW9uPSI3MjAwMDAvMTAwMDAiIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjIiIGV4aWY6Q29sb3JTcGFjZT0iNjU1MzUiIGV4aWY6UGl4ZWxYRGltZW5zaW9uPSIzMiIgZXhpZjpQaXhlbFlEaW1lbnNpb249IjMyIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RUNBQzNCQTE1MzgzMTFFMzlGNDJEQ0ZFRjFERTg0NjkiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RUNBQzNCQTI1MzgzMTFFMzlGNDJEQ0ZFRjFERTg0NjkiLz4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6YTlmYzkxMDMtOTA5Yy02YjQ0LThkYmYtNTBlOTMxYzk4NzUxIiBzdEV2dDp3aGVuPSIyMDE0LTA0LTMwVDE2OjU5OjAxKzA0OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpiMjI1NDA4My01Yjc3LTQ3YjItYTNhMy1mMzRmYzQ4Y2JhODgiIHN0RXZ0OndoZW49IjIwMTgtMDctMjNUMTY6NTA6NDUrMDM6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE4IChNYWNpbnRvc2gpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pl6UiBMAAAArSURBVFjD7c4xAQAADAKg2T+0i+EDCUjbW4qAgICAgICAgICAgICAgMA68JtVX8GGWuwhAAAAAElFTkSuQmCC]]>
	</data>
	<style name="plus_bar" type="container" align="center" bgcolor="0xffffff" bgalpha="1" bgroundedge="2" width="28" height="4" set_hover=" copy(bgcolor, accent_color); " set_idle=" set(bgcolor, 0xffffff); "></style>
	<style name="floor_layer" keep="true" handcursor="false" parent="map__scrollarea" aspect="0" linked_db_item="" floor_layer=" newlayer(%1, %2); set(this.linked_db_item, %3); copy(this.url, map_floor[%3].url); " show_before=" resize(); " resize="" onloaded=" callwhen(pixelwidth GT 0, calc(aspect, pixelwidth / pixelheight); set(width, 100%); set(height, 100%); ); "></style>
	<style name="map__container" style="invisible_content|visible|backdropblur" keep="true" type="container" align="righttop" x="0" y="0" bgcolor="0x000000" bgalpha="0.4" backdropblur="5" bgborder="1 0xffffff 0.1" bgalpha.firefox="0.8" width_compact="300" height_compact="300" width_expanded="0" height_expanded="0" width="300" height="300" state="1" resize=" copy(width_expanded, stagewidth); callwhen(layer[get(current_floor_map)].pixelheight GT 0, calc(height_expanded, (stagewidth - 20) / layer[get(current_floor_map)].aspect + 70); if (state == 2, copy(width, width_expanded); copy(height, height_expanded); ); copy(this, layer[get(name)]); callwith(layer[map__scrollarea], set_width_height(calc(layer[get(current_floor_map)].aspect * (this.height - 50)), calc(this.height - 50)); ); ); " expand=" set(state, 2); tween(width|height, calc(width_expanded + '|' + height_expanded), 0.5, easeInOutQuad); copy(this, layer[get(name)]); callwith(layer[map__scrollarea], expand(calc(this.width_expanded - 20), calc(this.height_expanded - 50)); ); " compact=" set(state, 1); tween(width|height, calc(width_compact + '|' + height_compact), 0.5, easeInOutQuad); copy(this, layer[get(name)]); callwith(layer[map__scrollarea], compact(calc(layer[get(current_floor_map)].aspect * (this.height_compact - 50)), calc(this.height_compact - 50)); ); "></style>
	<style name="map__expand" style="backdropblur" type="container" backdropblur="2" align="leftbottom" x="10" y="10" bgcolor="0x000000" bgalpha="0.8" bgborder="1 0xffffff 0.1" width="40" height="40" onover=" callwith(layer[expand__bar_1], set_hover); callwith(layer[expand__bar_2], set_hover); " onout=" callwith(layer[expand__bar_1], set_idle); callwith(layer[expand__bar_2], set_idle); " ondown=" callwith(layer[expand__bar_1], press); callwith(layer[expand__bar_2], press); " onup=" callwith(layer[expand__bar_1], unpress); callwith(layer[expand__bar_2], unpress); " set_minus=" callwith(layer[expand__bar_1], turn_in); callwith(layer[expand__bar_2], hide); " set_plus=" callwith(layer[expand__bar_1], turn_out); callwith(layer[expand__bar_2], show); " onclick_actions=" if (layer[map__container].state == 1, callwith(layer[map__container], expand); delayedcall (0.6, set_minus(); ); , layer[map__container].state == 2, callwith(layer[map__container], compact); delayedcall (0.6, set_plus(); ); ); "></style>
	<style name="expand__bar_1" style="plus_bar" rotate="90" turn_in=" tween(rotate, 0, 0.25, easeInOutQuad); " turn_out=" tween(rotate, 90, 0.25, easeInOutQuad); " press=" if (rotate == 90, set(ox, 1); , set(oy, 1); ); " unpress=" if (rotate == 90, set(ox, 0); , set(oy, 0); ); "></style>
	<style name="expand__bar_2" style="invisible_content|visible|plus_bar" press=" set(oy, 1); " unpress=" set(oy, 0); "></style>
	<style name="map__wrapper" type="container" maskchildren="true" align="bottom" y="10" bgcolor="0x000000" bgalpha="0.0" bgborder="1 0xffffff 0.1" width="-20" height="-50"></style>
	<style name="map__scrollarea" url="../plugins/scrollarea.js" align="center" direction="h" overscroll="0.75" height="100%" resize=" copy(width, layer[get(parent)].pixelwidth); " set_width_height=" set(width, %1); set(height, %2); " expand=" tween(width, %1, 0.5, easeInOutQuad); tween(height, %2, 0.5, easeInOutQuad, delayedcall (0.25, set(direction, null); ); ); " compact=" tween(width, %1, 0.5, easeInOutQuad); tween(height, %2, 0.5, easeInOutQuad, set(direction, 'h'); ); "></style>
	<events name="map__events" keep="true" onresize=" callwith(layer[map__container], resize); " onclick=" if (layer[map__container].state == 2, callwith(layer[map__expand], onclick_actions); ); "/>
	<action name="load_floor_maps">for(set(i, 0), i LT map_floor.count, inc(i), add_new_floor_layer(get(i)); ); set_floor(1);</action>
	<action name="add_new_floor_layer">calc(map_floor[%1].linked_layer, 'map__' + map_floor[%1].name); new(invisible_content|floor_layer, get(map_floor[%1].linked_layer), %1 );</action>
	<action name="set_floor">if (current_floor_map, callwith(layer[get(current_floor_map)], hide); ); copy(current_floor_map, map_floor[calc(%1 - 1)].linked_layer); callwhen(layer[get(current_floor_map)].pixelwidth GT 0, callwith(layer[get(current_floor_map)], show); ); callwith(layer[map__container], resize);</action>
	<layer name="map__container" style="map__container">
		<layer name="map__wrapper" style="map__wrapper">
			<layer name="map__scrollarea" style="map__scrollarea"/></layer>
		<layer name="map__expand" style="map__expand">
			<layer name="expand__bar_1" style="expand__bar_1"></layer>
			<layer name="expand__bar_2" style="expand__bar_2"></layer>
			<layer name="expand__toucharea" style="interactive_area"></layer>
		</layer>
	</layer>
</krpano>